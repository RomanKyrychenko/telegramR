---
title: "Downloading Channel Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Downloading Channel Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

This vignette demonstrates how to download channel data with `telegramR` using the high‑level helpers.

## Setup and Authentication

```{r setup, eval=FALSE}
library(telegramR)

# Replace these with your own API ID and Hash
api_id <- 123456
api_hash <- "0123456789abcdef0123456789abcdef"

client <- TelegramClient$new("my_session", api_id, api_hash)
client$start()
```

## Download Messages

```{r download_messages, eval=FALSE}
# Download the most recent 200 messages from a channel
msgs <- download_channel_messages(
  client,
  "telegram",
  limit = 200
)

msgs
```

The returned tibble includes a compact, analysis‑ready schema:

- `message_id`, `date`, `text`
- `views`, `forwards`, `replies`
- `reactions_total`, `reactions_json`
- `media_type`, `is_forward`, `forward_from_id`, `forward_from_name`
- `reply_to_msg_id`, `edit_date`, `post_author`
- `channel_id`, `channel_username`, `channel_title`

## Download Channel Info

```{r download_info, eval=FALSE}
info <- download_channel_info(client, "telegram")
info
```

## Estimate Total Posts (Approx.)

This returns the latest message id as an **upper‑bound estimate**.

```{r estimate, eval=FALSE}
estimate_channel_post_count(client, "telegram")
```

## Download Media

```{r download_media, eval=FALSE}
# Find the first message with media
first_media <- msgs[which(!is.na(msgs$media_type) & msgs$media_type != ""), ][1, ]

if (nrow(first_media) > 0) {
  # You can still use download_media on the underlying message object
  # if you need the original media data.
}
```

## Disconnect

```{r disconnect, eval=FALSE}
client$disconnect()
```
```{r download_messages_range, eval=FALSE}
# Download a date range (UTC)
msgs_range <- download_channel_messages(
  client,
  "telegram",
  start_date = "2025-01-01",
  end_date   = "2025-02-01",
  limit      = Inf
)
```
